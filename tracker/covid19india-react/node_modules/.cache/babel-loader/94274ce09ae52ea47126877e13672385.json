{"ast":null,"code":"import _slicedToArray from\"/home/ubuntu/myprojectdir/tracker/covid19india-react/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{STATISTIC_CONFIGS,D3_TRANSITION_DURATION}from'../constants';import{formatDate,formatNumber,getIndiaYesterdayISO,getStatistic}from'../utils/commonFunctions';import{min,max}from'd3-array';import{axisBottom}from'd3-axis';import{scaleBand,scaleLinear}from'd3-scale';import{select}from'd3-selection';// eslint-disable-next-line\nimport{transition}from'd3-transition';import equal from'fast-deep-equal';import React,{useEffect,useRef}from'react';import{useMeasure}from'react-use';var getDeltaStatistic=function getDeltaStatistic(data,statistic){return getStatistic(data,'delta',statistic);};var margin={top:50,right:0,bottom:50,left:0};function DeltaBarGraph(_ref){var timeseries=_ref.timeseries,statistic=_ref.statistic,lookback=_ref.lookback;var svgRef=useRef();var _useMeasure=useMeasure(),_useMeasure2=_slicedToArray(_useMeasure,2),wrapperRef=_useMeasure2[0],_useMeasure2$=_useMeasure2[1],width=_useMeasure2$.width,height=_useMeasure2$.height;var pastDates=Object.keys(timeseries||{}).filter(function(date){return date<=getIndiaYesterdayISO();});var dates=pastDates.slice(-lookback);useEffect(function(){if(!width)return;var svg=select(svgRef.current);var chartRight=width-margin.right;var chartBottom=height-margin.bottom;var r=5;// const formatTime = timeFormat('%e %b');\nvar xScale=scaleBand().domain(dates).range([margin.left,chartRight]).paddingInner(width/1000);var yScale=scaleLinear().domain([Math.min(0,min(dates,function(date){return getDeltaStatistic(timeseries===null||timeseries===void 0?void 0:timeseries[date],statistic);})),Math.max(1,max(dates,function(date){return getDeltaStatistic(timeseries===null||timeseries===void 0?void 0:timeseries[date],statistic);}))]).range([chartBottom,margin.top]);var xAxis=axisBottom(xScale).tickSize(0).tickFormat(function(date){return formatDate(date,'dd MMM');});var t=svg.transition().duration(D3_TRANSITION_DURATION);svg.select('.x-axis').transition(t).style('transform',\"translateY(\".concat(yScale(0),\"px)\")).call(xAxis).on('start',function(){return svg.select('.domain').remove();}).selectAll('text').attr('y',0).attr('dy',function(date,i){return getDeltaStatistic(timeseries===null||timeseries===void 0?void 0:timeseries[date],statistic)<0?'-1em':'1.5em';}).style('text-anchor','middle').attr('fill',STATISTIC_CONFIGS[statistic].color);svg.selectAll('.bar').data(dates).join(function(enter){return enter.append('path').attr('class','bar').attr('d',function(date){return roundedBar(xScale(date),yScale(0),xScale.bandwidth(),0,r);});}).transition(t).attr('d',function(date){return roundedBar(xScale(date),yScale(0),xScale.bandwidth(),yScale(0)-yScale(getDeltaStatistic(timeseries===null||timeseries===void 0?void 0:timeseries[date],statistic)),r);}).attr('fill',function(date,i){return i<dates.length-1?STATISTIC_CONFIGS[statistic].color+'90':STATISTIC_CONFIGS[statistic].color;});var textSelection=svg.selectAll('.label').data(dates).join('text').attr('class','label').attr('x',function(date){return xScale(date)+xScale.bandwidth()/2;}).text(function(date){return formatNumber(getDeltaStatistic(timeseries===null||timeseries===void 0?void 0:timeseries[date],statistic));});textSelection.transition(t).attr('fill',STATISTIC_CONFIGS[statistic].color).attr('y',function(date){var val=getDeltaStatistic(timeseries===null||timeseries===void 0?void 0:timeseries[date],statistic);return yScale(val)+(val<0?15:-6);});textSelection.append('tspan').attr('dy',function(date){return\"\".concat(getDeltaStatistic(timeseries===null||timeseries===void 0?void 0:timeseries[date],statistic)<0?1.2:-1.2,\"em\");}).attr('x',function(date){return xScale(date)+xScale.bandwidth()/2;}).text(function(date,i){if(i===0)return'';var prevVal=getDeltaStatistic(timeseries===null||timeseries===void 0?void 0:timeseries[dates[i-1]],statistic);if(!prevVal)return'';var delta=getDeltaStatistic(timeseries===null||timeseries===void 0?void 0:timeseries[date],statistic)-prevVal;return\"\".concat(delta>0?'+':'').concat(formatNumber(100*delta/Math.abs(prevVal)),\"%\");}).transition(t).attr('fill',STATISTIC_CONFIGS[statistic].color+'90');},[dates,height,statistic,timeseries,width]);return/*#__PURE__*/React.createElement(\"div\",{className:\"DeltaBarGraph\",ref:wrapperRef},/*#__PURE__*/React.createElement(\"svg\",{ref:svgRef,width:width,height:250,viewBox:\"0 0 \".concat(width,\" \").concat(height),preserveAspectRatio:\"xMidYMid meet\"},/*#__PURE__*/React.createElement(\"g\",{className:\"x-axis\"}),/*#__PURE__*/React.createElement(\"g\",{className:\"y-axis\"})));}var isEqual=function isEqual(prevProps,currProps){if(currProps.forceRender){return false;}else if(!currProps.timeseries&&prevProps.timeseries){return true;}else if(currProps.timeseries&&!prevProps.timeseries){return false;}else if(!equal(prevProps.stateCode,currProps.stateCode)){return false;}else if(!equal(prevProps.lookback,currProps.lookback)){return false;}else if(!equal(prevProps.statistic,currProps.statistic)){return false;}return true;};export default React.memo(DeltaBarGraph,isEqual);function roundedBar(x,y,w,h,r){r=Math.sign(h)*Math.min(Math.abs(h),r);var paths=[\"M \".concat(x,\" \").concat(y),\"v \".concat(-h+r),\"q 0 \".concat(-r,\" \").concat(Math.abs(r),\" \").concat(-r),\"h \".concat(w-2*Math.abs(r)),\"q \".concat(Math.abs(r),\" 0 \").concat(Math.abs(r),\" \").concat(r),\"v \".concat(h-r),'Z'];return paths.join(' ');}","map":{"version":3,"sources":["/home/ubuntu/myprojectdir/tracker/covid19india-react/src/components/DeltaBarGraph.js"],"names":["STATISTIC_CONFIGS","D3_TRANSITION_DURATION","formatDate","formatNumber","getIndiaYesterdayISO","getStatistic","min","max","axisBottom","scaleBand","scaleLinear","select","transition","equal","React","useEffect","useRef","useMeasure","getDeltaStatistic","data","statistic","margin","top","right","bottom","left","DeltaBarGraph","timeseries","lookback","svgRef","wrapperRef","width","height","pastDates","Object","keys","filter","date","dates","slice","svg","current","chartRight","chartBottom","r","xScale","domain","range","paddingInner","yScale","Math","xAxis","tickSize","tickFormat","t","duration","style","call","on","remove","selectAll","attr","i","color","join","enter","append","roundedBar","bandwidth","length","textSelection","text","val","prevVal","delta","abs","isEqual","prevProps","currProps","forceRender","stateCode","memo","x","y","w","h","sign","paths"],"mappings":"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","sourcesContent":["import {STATISTIC_CONFIGS, D3_TRANSITION_DURATION} from '../constants';\nimport {\n  formatDate,\n  formatNumber,\n  getIndiaYesterdayISO,\n  getStatistic,\n} from '../utils/commonFunctions';\n\nimport {min, max} from 'd3-array';\nimport {axisBottom} from 'd3-axis';\nimport {scaleBand, scaleLinear} from 'd3-scale';\nimport {select} from 'd3-selection';\n// eslint-disable-next-line\nimport {transition} from 'd3-transition';\nimport equal from 'fast-deep-equal';\nimport React, {useEffect, useRef} from 'react';\nimport {useMeasure} from 'react-use';\n\nconst getDeltaStatistic = (data, statistic) => {\n  return getStatistic(data, 'delta', statistic);\n};\n\nconst margin = {top: 50, right: 0, bottom: 50, left: 0};\n\nfunction DeltaBarGraph({timeseries, statistic, lookback}) {\n  const svgRef = useRef();\n  const [wrapperRef, {width, height}] = useMeasure();\n\n  const pastDates = Object.keys(timeseries || {}).filter(\n    (date) => date <= getIndiaYesterdayISO()\n  );\n  const dates = pastDates.slice(-lookback);\n\n  useEffect(() => {\n    if (!width) return;\n    const svg = select(svgRef.current);\n\n    const chartRight = width - margin.right;\n    const chartBottom = height - margin.bottom;\n    const r = 5;\n\n    // const formatTime = timeFormat('%e %b');\n    const xScale = scaleBand()\n      .domain(dates)\n      .range([margin.left, chartRight])\n      .paddingInner(width / 1000);\n\n    const yScale = scaleLinear()\n      .domain([\n        Math.min(\n          0,\n          min(dates, (date) => getDeltaStatistic(timeseries?.[date], statistic))\n        ),\n        Math.max(\n          1,\n          max(dates, (date) => getDeltaStatistic(timeseries?.[date], statistic))\n        ),\n      ])\n      .range([chartBottom, margin.top]);\n\n    const xAxis = axisBottom(xScale)\n      .tickSize(0)\n      .tickFormat((date) => formatDate(date, 'dd MMM'));\n\n    const t = svg.transition().duration(D3_TRANSITION_DURATION);\n\n    svg\n      .select('.x-axis')\n      .transition(t)\n      .style('transform', `translateY(${yScale(0)}px)`)\n      .call(xAxis)\n      .on('start', () => svg.select('.domain').remove())\n      .selectAll('text')\n      .attr('y', 0)\n      .attr('dy', (date, i) =>\n        getDeltaStatistic(timeseries?.[date], statistic) < 0 ? '-1em' : '1.5em'\n      )\n      .style('text-anchor', 'middle')\n      .attr('fill', STATISTIC_CONFIGS[statistic].color);\n\n    svg\n      .selectAll('.bar')\n      .data(dates)\n      .join((enter) =>\n        enter\n          .append('path')\n          .attr('class', 'bar')\n          .attr('d', (date) =>\n            roundedBar(xScale(date), yScale(0), xScale.bandwidth(), 0, r)\n          )\n      )\n      .transition(t)\n      .attr('d', (date) =>\n        roundedBar(\n          xScale(date),\n          yScale(0),\n          xScale.bandwidth(),\n          yScale(0) - yScale(getDeltaStatistic(timeseries?.[date], statistic)),\n          r\n        )\n      )\n      .attr('fill', (date, i) => {\n        return i < dates.length - 1\n          ? STATISTIC_CONFIGS[statistic].color + '90'\n          : STATISTIC_CONFIGS[statistic].color;\n      });\n\n    const textSelection = svg\n      .selectAll('.label')\n      .data(dates)\n      .join('text')\n      .attr('class', 'label')\n      .attr('x', (date) => xScale(date) + xScale.bandwidth() / 2)\n      .text((date) =>\n        formatNumber(getDeltaStatistic(timeseries?.[date], statistic))\n      );\n\n    textSelection\n      .transition(t)\n      .attr('fill', STATISTIC_CONFIGS[statistic].color)\n      .attr('y', (date) => {\n        const val = getDeltaStatistic(timeseries?.[date], statistic);\n        return yScale(val) + (val < 0 ? 15 : -6);\n      });\n\n    textSelection\n      .append('tspan')\n      .attr(\n        'dy',\n        (date) =>\n          `${\n            getDeltaStatistic(timeseries?.[date], statistic) < 0 ? 1.2 : -1.2\n          }em`\n      )\n      .attr('x', (date) => xScale(date) + xScale.bandwidth() / 2)\n      .text((date, i) => {\n        if (i === 0) return '';\n        const prevVal = getDeltaStatistic(\n          timeseries?.[dates[i - 1]],\n          statistic\n        );\n        if (!prevVal) return '';\n        const delta =\n          getDeltaStatistic(timeseries?.[date], statistic) - prevVal;\n        return `${delta > 0 ? '+' : ''}${formatNumber(\n          (100 * delta) / Math.abs(prevVal)\n        )}%`;\n      })\n      .transition(t)\n      .attr('fill', STATISTIC_CONFIGS[statistic].color + '90');\n  }, [dates, height, statistic, timeseries, width]);\n\n  return (\n    <div className=\"DeltaBarGraph\" ref={wrapperRef}>\n      <svg\n        ref={svgRef}\n        width={width}\n        height={250}\n        viewBox={`0 0 ${width} ${height}`}\n        preserveAspectRatio=\"xMidYMid meet\"\n      >\n        <g className=\"x-axis\" />\n        <g className=\"y-axis\" />\n      </svg>\n    </div>\n  );\n}\n\nconst isEqual = (prevProps, currProps) => {\n  if (currProps.forceRender) {\n    return false;\n  } else if (!currProps.timeseries && prevProps.timeseries) {\n    return true;\n  } else if (currProps.timeseries && !prevProps.timeseries) {\n    return false;\n  } else if (!equal(prevProps.stateCode, currProps.stateCode)) {\n    return false;\n  } else if (!equal(prevProps.lookback, currProps.lookback)) {\n    return false;\n  } else if (!equal(prevProps.statistic, currProps.statistic)) {\n    return false;\n  }\n  return true;\n};\n\nexport default React.memo(DeltaBarGraph, isEqual);\n\nfunction roundedBar(x, y, w, h, r) {\n  r = Math.sign(h) * Math.min(Math.abs(h), r);\n  const paths = [\n    `M ${x} ${y}`,\n    `v ${-h + r}`,\n    `q 0 ${-r} ${Math.abs(r)} ${-r}`,\n    `h ${w - 2 * Math.abs(r)}`,\n    `q ${Math.abs(r)} 0 ${Math.abs(r)} ${r}`,\n    `v ${h - r}`,\n    'Z',\n  ];\n  return paths.join(' ');\n}\n"]},"metadata":{},"sourceType":"module"}